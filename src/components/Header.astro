---
interface Props {
  lang: "es" | "en";
  dict: any;
}
const { lang, dict } = Astro.props;
---

<header
  class="sticky top-0 z-50 flex justify-center items-center py-5 w-full mx-auto bg-[#00091d]/80 backdrop-blur shadow-md"
>
  <nav class="w-full max-w-5xl px-4 mx-auto flex items-center justify-between">
    <!-- Left: mobile menu button + logo / home -->
    <div class="flex items-center gap-4">
      <button
        id="nav-toggle"
        aria-controls="nav-menu"
        aria-expanded="false"
        class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-blue-100 bg-[#00091d] backdrop-blur shadow-md focus:outline-none focus:ring-2 focus:ring-blue-300"
      >
        <span class="sr-only">Open main menu</span>
        <!-- Hamburger icon -->
        <svg
          class="h-6 w-6"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <a href="#top" class="text-sm font-medium">{dict.header.home}</a>
    </div>

    <!-- Desktop nav -->
    <ul class="hidden md:flex md:items-center md:gap-x-8 text-sm opacity-90">
      <li><a href="#sobremi">{dict.header.about}</a></li>
      <li><a href="#experiencia">{dict.header.experience}</a></li>
      <li><a href="#proyectos">{dict.header.projects}</a></li>
      <li><a href="#contacto">{dict.header.contact}</a></li>
    </ul>

    <!-- Right: language select + mobile button -->
    <div class="flex items-center gap-3">
      <div class="hidden md:block relative">
        <select
          class="ml-4 bg-blue-900 text-blue-100 border border-blue-300 rounded-lg text-base font-medium cursor-pointer px-6 py-1 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-300 transition"
          aria-label="Idioma"
          id="lang-select"
          style="padding-right: 2.5rem; min-width: 4.5rem;"
        >
          <option value="es" selected={lang === "es"}>ES</option>
          <option value="en" selected={lang === "en"}>EN</option>
        </select>
        <svg
          style="pointer-events:none; position:absolute; right:18px; top:50%; transform:translateY(-50%); width:1.2em; height:1.2em; color:rgb(147,197,253);"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M19 9l-7 7-7-7"></path>
        </svg>
      </div>

      <!-- space reserved for right-side controls on desktop -->
    </div>

    <!-- Mobile menu (fixed panel) -->
    <div id="nav-menu" class="md:hidden">
      <div id="nav-panel" class="hidden fixed inset-0 z-50">
        <!-- Backdrop -->
        <div id="nav-backdrop" class="absolute inset-0 bg-black/30"></div>

        <!-- Panel: occupy full height and half width (tablet and up 40%) -->
        <aside
          id="nav-aside"
          class="fixed left-0 top-0 w-1/2 md:w-1/3 h-screen bg-[#00091d] backdrop-blur-lg p-6 flex flex-col gap-4 text-sm text-blue-100 shadow-lg"
          aria-hidden="true"
        >
          <button
            id="nav-close"
            aria-label="Cerrar menú"
            class="self-end p-2 rounded-md text-blue-100 hover:bg-blue-800/40 focus:outline-none focus:ring-2 focus:ring-blue-300"
          >
            <svg
              class="h-6 w-6"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>

          <a href="#top" class="block text-base font-medium"
            >{dict.header.home}</a
          >
          <a href="#sobremi" class="block py-2">{dict.header.about}</a>
          <a href="#experiencia" class="block py-2">{dict.header.experience}</a>
          <a href="#proyectos" class="block py-2">{dict.header.projects}</a>
          <a href="#contacto" class="block py-2">{dict.header.contact}</a>

          <div class="mt-auto">
            <label for="lang-select-mobile" class="sr-only">Idioma</label>
            <select
              id="lang-select-mobile"
              class="w-full bg-blue-900 text-blue-100 border border-blue-300 rounded-lg px-4 py-2 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-300"
            >
              <option value="es" selected={lang === "es"}>ES</option>
              <option value="en" selected={lang === "en"}>EN</option>
            </select>
          </div>
        </aside>
      </div>
    </div>

    <script is:inline>
      // Panel móvil: open/close con backdrop, bloqueo de scroll y manejo de idioma
      window.addEventListener("DOMContentLoaded", function () {
        var toggle = document.getElementById("nav-toggle");
        var panel = document.getElementById("nav-panel");
        var backdrop = document.getElementById("nav-backdrop");
        var closeBtn = document.getElementById("nav-close");
        var desktopSelect = document.getElementById("lang-select");
        var mobileSelect = document.getElementById("lang-select-mobile");
        var aside = document.getElementById("nav-aside");

        function setLangAndRedirect(newLang) {
          document.cookie = "lang=" + newLang + ";path=/;max-age=31536000";
          if (newLang === "es") {
            window.location.pathname = "/es/";
          } else if (newLang === "en") {
            window.location.pathname = "/en/";
          }
        }

        var initial = document.documentElement.lang || "es";
        if (desktopSelect) desktopSelect.value = initial;
        if (mobileSelect) mobileSelect.value = initial;

        if (desktopSelect)
          desktopSelect.addEventListener("change", function (e) {
            setLangAndRedirect(e.target.value);
          });
        if (mobileSelect)
          mobileSelect.addEventListener("change", function (e) {
            setLangAndRedirect(e.target.value);
          });

        function openMenu() {
          if (!panel) return;
          panel.classList.remove("hidden");
          toggle.setAttribute("aria-expanded", "true");
          if (aside) aside.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";
        }

        function closeMenu() {
          if (!panel) return;
          panel.classList.add("hidden");
          toggle.setAttribute("aria-expanded", "false");
          if (aside) aside.setAttribute("aria-hidden", "true");
          document.body.style.overflow = "";
        }

        if (toggle) {
          toggle.addEventListener("click", function () {
            var expanded = toggle.getAttribute("aria-expanded") === "true";
            if (expanded) closeMenu();
            else openMenu();
          });
        }

        if (closeBtn) closeBtn.addEventListener("click", closeMenu);
        if (backdrop) backdrop.addEventListener("click", closeMenu);

        // close on escape
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") closeMenu();
        });

        // ensure closed initially
        if (panel) panel.classList.add("hidden");
      });
    </script>
  </nav>
</header>
